# Multi-training based Recognition of Urban Green Cover  on Multi-Temporal High Resolution Remote Sensing Images



## Abstract

城市绿地在生态城市建设以及构建宜居环境中占有非常重要的地位，城市绿化信息的监测对于城市管理有重要意义。多时相高分辨率遥感影像是城市绿地信息更新的重要数据源，而从这些影像中有效识别植被信息是其中一个关键环节，但是这往往面临很多问题。在监督学习中要取得好的效果通常需要大规模的标记样本，而遥感影像上训练样本的标注是一件费时费力的事情。同时由于各个时相间数据分布存在漂移，单个时相下的训练样本无法直接应用于其他时相，这造成了标记样本的极大的浪费。构建多时相下影像中植被以及其他各类地物信息提取的框架在处理这类问题中是有现实意义的。本研究立足于半监督学习，基于多个时相下的高分辨率遥感影像，提出了一个能够在多个时相间进行协同训练来进行地物分类的算法。该方法很好地解决了多时相数据分布偏移和不适定的问题，在保证分类结果一致性的同时有效地提升了各影像上小样本训练的精度，给多时相遥感影像地物提取带来了一种新的模式。

## 1 Introduction

[Paragraph. 1. 城市绿地的重要作用以及==多时相==监测必要性](植被作为城市生态景观的重要组成部分，在空气净化、水分涵养、减小噪声等方面起着关键作用，对环境的净化有重要作用，所以及时准确地监测城市绿地的信息具有很强的现实意义。而遥感影像是提取城市植被覆盖信息的有效手段，常用的数据来源有Landsat，MODIS，高分辨率遥感影像给城市植被的监测带来了新的动力，高空间分辨率的特点提供了更精准的植被提取结果，并且在时相上提供了充足的数据。多时相遥感影像丰富的数据为地物分类提供了强有力的支持，相比于单时相下的分类能够更加有效地区分地物（[N. A. Abade et al. 2015][6]），但是同时多时相下遥感影像分类主要面临这几个问题，（1）采用监督学习的方法去提取植被信息能够获得较好的效果，但是同时也需要大量的有标记样本，费时费力（2）由于植被的波谱信息受季节影像较大，造成数据分布上的偏移，单个时相下的训练样本难以直接用于另一个时相，造成了训练样本的极大浪费。多时相遥感影像给城市植被提取带来了更多的机遇和挑战。)

[Paragraph. 2. 目前==多时相下==城市植被覆盖识别的方法和挑战](在多时相上地物分类问题上，有研究人员直接应用机器学习相关方法于堆叠的多时相数据上，但是没有考虑其中时相间的联系，孤立地考虑单个时相的分类，造成了信息的浪费。伴随着深度学习的发展，有研究结合深度学习中的循环神经网络来挖掘时间序列上的遥感影像信息，好处在于可以利用循环神经网络处理时序数据的优势，但是带来的是计算开销以及标记样本数量的问题，针对该问题，有研究人员提出利用半监督学习的框架，能够基于小样本的情况下得到较好的分类效果。有利用协同训练对时序遥感影像中的积雪进行识别提取，有利用tri-training方法对于遥感影像中的地物进行分类，有利用半监督学习模糊C均值聚类的方法动态提取时间序列遥感影像中的植被信息)

[Paragraph. 3 本文涉及相关领域介绍]()

[（1） 领域自适应](领域自适应是迁移学习的一种代表性方法，数据包含源域和目标域，其目的是将在源域上训练的分类器能够应用于目标域进行利用，从而充分利用源域学得的知识。此类方法通常有基于样本的迁移，基于特征的迁移，基于模型的迁移，这一类方法已在遥感领域被广泛应用，在遥感影像地物分类上，在遥感分类结果图的更新上，此类方法利用了相近时相上地物类别不会发生显著变化的这一特点，但是面临的直接问题就是如果要模型迁移学习得足够好，同样也需要大量的源域有标记样本来训练分类器。)

[（2） 半监督学习](当有标记的训练样本不足时，分类器通过监督学习有时并不能得到一个理想的结果，而未标记的样本数量足够，不加以利用会造成数据信息的浪费。半监督学习被提出用以解决此类问题。其主要思想是利用有标记的训练样本训练一个初始分类器，然后在训练过程中根据规则不断地添加新的训练样本进入训练集，反复迭代来使分类器得到学习。半监督学习领域可分为这四种方法，生成式方法（[Shahashahani and Landgrebe, 1994][1]），低密度分离算法，如TSVM（[Joachims,1999][2]; [Vapnik, 1998][3]），基于图的方法（[Jordan, 1998][4]），基于分歧的方法，如协同训练（[Blum and Mitchell, 1998][5]）。这些半监督学习的方法在机器学习的相关任务上取得了显著的效果，许多学者利用协同训练的方法进行遥感影像时相间的分类，但是由于遥感影像数据分布的复杂性，如异物同谱、同物异谱，以及时相间数据的偏移，直接套用这些方法往往不能取得理想的效果。)

[Paragraph. 4. 本研究的主要流程和方法介绍](本工作提出了一个能够在多时相上基于少量样本进行地物分类的方法，利用半监督学习的思想，选取了同一年上的四个时相的遥感影像数据，经过预处理校正和配准以后，采用对应的四个分类器，在初始给定极少量样本的训练条件下，每一轮迭代生成每个时相上的预测概率图，结合四个分类器的概率输出值，计算同一个样本的未变化值，注意这个值既可以指代单个像元的变化与否情况，同时指出了这个像元的类别，我们根据设定的阈值，每次迭代选取一定数量的样本加入到训练集中，继续训练各个时相间的学习器，直至迭代完成。)

[Paragraph. 5. 本工作的突出贡献](本研究主要有四个主要贡献)

[（1） 和大规模有标记样本的监督学习相比较，本研究实现了==小样本==下地物分类精度的提升，尤其是针对植被覆盖信息。]()

[（2）本研究将不同时相间数据的偏移转换成了促进未标记样本选择的动力，借此生成了时相上的==未变化区域==概率图，保证了==一致性==。]()

[（3）本研究对于之前的两个时相间的协调训练进行了改进，来减少对于时相间数据选择上的依赖]()

[（4）本研究的框架立足于时间序列，整体地考虑了多个时相下分类器分类的结果，相比于之前的单时相主动学习和双时相下的协同训练，在多个时相的地物提取上取得更高的精度提升。]()

[Paragraph. 6. 文章的组织架构简要介绍和提示](这篇文章剩下部分将主要分为，第二块是对于方法的介绍，基分类器的选择、多时相分类器的构建、未标记样本的选取和训练流程介绍，第三块是一个针对研究区和数据的介绍，第四块是整个研究实验的设计，第五块是结果的呈现和对比分析，第六、七块是讨论和总结。)

## 2 Methodology

### 2.1 Base Classifier

[Paragraph. 1. 介绍随机森林分类器](随机森林是机器学习中的一种常用方法，随机森林基于决策树的方法，在数据的选择上引入随机性，并构建多棵决策树，然后再汇总决策树的结果。随机森林可以在运算量没有显著增加的情况下提高预测精度，成为多项数据比赛中的常用模型。以下为随机森林的流程：（1）假设有N个样本，有放回地随机选择N个样本，于是选择了N个样本用来训练一棵决策树，作为决策树根节点处的样本。（2）当每个样本都具有M个属性时，在决策树的节点要分裂时，随机从M个中选择出m个属性中（m远小于M），之后采用决策树选择属性的方法选择出一个最优属性进行分裂。（3）决策树形成过程反复按照（2）进行分裂，直到不能分裂为止。（4）按照（1）（2）（3）构建大量的决策树，形成随机森林。)

[Paragraph. 2. 介绍随机森林分类器在半监督学习中的应用]()

[Paragraph. 3. 说明分类器的可替换性 ](在我们的算法设计中，随机森林分类器并不是唯一可行的基分类器，实际上在我们的算法中，基分类器需要满足能够给出样本预测类别的概率，便于后续在选择样本中以一定的概率被选中。所以基分类器的核心特点是能够给出预测样本集的概率分布，我们的方法可以使用不同的基学习器来进行扩展)

### 2.2 Multi-temporal extensions of Base Classifier

[Paragraph. 1. 介绍如何将单个时相的分类器拓展到多个时相](在多时相的设置下，需要一种级联的机制，来有效地利用时相间的相关信息，能够让各个时相下的分类器在训练时进行互相沟通，将各自获取的信息在全局分类器下进行共享。在这个问题下的假设是时间相近的时相下大部分地物类别并没有发生改变，基于这个前提，我们提出的算法让分类器在各自时相下进行学习，学到各自时相下的数据分布，然后每一轮学完后，进行信息的沟通，而这个沟通的方式分为两阶段，评估和更新。评估阶段的目的是为了计算多个时相下同一位置的样本在多个分类器下的预测类别的置信度，更新阶段是为了将置信度高的样本放进各个分类器的训练集中，让各个分类器在一轮后的沟通过程中互相学习，增加单个分类器的鲁棒性和全局分类器的一致性。在迭代有限轮后，多个分类器的分类结果更加一致，但原始数据天然的不同保证了各自分类器的差异性。)

### 2.3 Selection of unlabeled sample for training

[Paragraph. 1. 阐述多时相间数据分布会发生偏移](当处理多时相遥感影像数据时，不可避免地会遇到数据偏移问题。带来数据分布不一致的原因来自各个方面，在不同的时间下，由于受到大气辐射、自身的位置和高度角的变化等因素的影响，卫星的成像条件有着较大的差异，导致即使是同一个区域，拍摄出来的遥感影像也会有差别；而从不同时相季节变化带来的影响考虑，各时相下影像中地物在波谱上也会有变化；加上地物自身类别的变化，同一地区的影像数据分布可能发生严重的偏移，甚至地物类别空间也会产生转变。由于数据分布偏移问题存在，直接将一幅遥感影像中的样本应用于其他时相，往往会造成分类准确率低，分类结果不一致的问题。)

[Paragraph. 2. 在多时相的数据上直接找寻长时间序列上的未变化区域很困难](为了充分利用时相间的信息，最重要的一个步骤就是确定地物的类别未变化区域和变化区域，从而能够利用未变化区域多时相上的信息冗余进行多时相协同训练，提高分类准确度。执行时相间协同训练的算法大多数在进行正式训练之前，需要设定衡量准则，将变化区域和未变化区域划分出来，之后针对未变化区域进行训练。在多个时相间设定统一的衡量标准等同于陷入了之前陈述的数据偏移误区，由于各个影像上的数据分布已经发生变化，在无数据域信息介入的情况下划分是非常朴素的。举个例子，我们有两群人，试图找出两群人中的最高者，已知第一群人普遍较矮，第二群人较高，现已有第一群人中的最高者，我们并不能直接说第二群人中身高和该人相等的就是他们的最高者，因为身高数据的整体分布已经发生了变化，甚至可能第二群人中身高等于此的是他们的最矮者。所以我们必须立足于各个数据域来判断未变化区域。)

[Paragraph. 3. 本工作隐式地选取了未变化区域](在我们设计的多时相训练方法中，我们抛弃了之前显式地根据数据域之间的距离度量衡量未变化区域的方法，改用隐式地基于各个分类器在各自时相上的预测概率，计算像元多时相上的联合置信度来决定。具体的计算方式为，基于每一轮的分类结果的概率输出值，根据多个时相上的分类器的输出概率来计算未变化的概率（解释联合概率的意义，举例）)

[Paragraph. 4. 本研究具体选择未标记样本的细节](在每一轮分类器做出预测之后，我们通过如上方法可以得到一张这段时间内的类别置信度图，之后采用半监督学习的框架，每一轮更新时计算该类别总体置信度平均值，将其设置为阈值，挑选出图上每一类中像元的置信度高于该阈值的像元，从中随机选择固定个数的样本加入训练集中，形成新的训练集，重复该过程直到达到预定训练次数。)

### 2.4 Multi-training

[Paragraph. 1. 具体的训练流程]()

[Paragraph. 2. 训练中需要注意的细节]()



==3，4考虑合在一块==

## 3 Study area and data

### 3.1 Study area

[Paragraph. 1. 研究区的地理位置，地理环境的介绍，选择该区域的原因和意义](研究区坐落在中国江苏省南京市宣武区，主要范围是玄武湖附近的城区。)

### 3.2 Data

[Paragraph. 1. 介绍哨兵数据]()

[Paragraph. 2. 介绍选取的多时相数据]()

[Paragraph. 3. 介绍数据特征，训练集划分的类别和依据](为了增强我们已有的数据，我们尝试在前人的基础上构建一些有意义的指标。我们初步选取了这些指标，并且从现有数据中采样通过关联分析来建立起特征与地物类别的相关联程度，在下图中我们展示了这几个指标的关联程度，并且按从大到小顺序选取了前五个指标（）和原有的四个波段组成了9维的特征，共同作为数据集的最终特征。在每一期的影像上，我们都随机标记了相同数量的样本，这里我们标记的数量是对于5个类别的地物每一类1000个样本。在这个有标记的数据集上我们进一步进行了划分，按照1：4的比例分成训练集和测试集。并且这里的训练集提供的是供后续训练采样的训练池，每一次训练从中独立重复采样出固定个数的有标记样本作为实验的训练集。)

## 4 Experimental design

### 4.1 Validation rules

[Paragraph. 1. F1-score计算方式介绍]()

### 4.2 Experimental setup

[Paragraph. 1. 时相的组合训练设定]((a) 为了判断时相的组合对算法的影响，我们调整时相的数量以及时相的组合方式，来测试算法在多时相遥感影像上对于小样本训练集的精度提升。在我们的实验中，我们设置的时相数量为3，4，5，6，7，8，依次从2017年开始往后增加时相，通过不同数量的时相组合寻找算法组合时相的最佳数量。最终衡量的指标是多个时相下精度提升的平均值，由于其他的方法和时相的数量并不直接联系，所以在此仅探讨本文方法在时相数量上的规律。)

[Paragraph. 2. 标记样本数量的设定]()

[Paragraph. 3. 未标记样本数量的设定]()

[Paragraph. 4. 阈值的设定]()

[Paragraph. 5. 不同训练方法的设定]()

## 5 Results

### 5.1 Mapping results of Multi-training

[Paragraph. 1. 分析多时相训练下各时期影像的植被提取结果图](为了直观地展示植被提取的结果，并且定性地进行分析，我们对照了四个时相下的分类结果，并着重凸显了植被提取的区域。为了方便定位，我们在结果图中也可视化了玄武湖水体。下图左边一列摆放的是4个时相下的sentinal影像下的研究区，中间的是我们的算法所提取的植被结果图，右边一列则是单时相下半监督学习得到的植被提取结果。从我们的算法和单时相下的效果对比可以看出，我们的算法提取的植被更加的细腻和准确。尽管是基于像元的分类，在大面积植被覆盖的区域，我们提取的结果仍然具有很好的一致性，相比之下，单时相半监督学习提取的植被较为破碎。而在城市街区的植被覆盖识别上，从我们的结果中可以明显看出植被沿道路分布的趋势，在该项上会比其他算法做的更好。而在多个时相上整体地判断，我们的算法所提取的植被具有更好的时间一致性，能够体现时相变化带来的对植被的影响，比如季节更迭带来的山区植被的减少和增加。我们设计的算法在多时相植被提取上具有显著的优势。)

[Paragraph. 2. 比较每一轮迭代所选取的区域]()

### 5.2 Performance of Multi-training

[Paragraph. 1. 和之前的方法进行比较]()

[Paragraph. 2. 分析该方法比之前方法更优的原因 ]()

### 5.3 Influence of unlabeled sample selection

[Paragraph. 1. 每一轮更新未标记样本数量的影响]()

[Paragraph. 2. 设定的阈值对于结果的影响]()

### 5.4 Influence of different number of phases

[Paragraph. 1. 时相数增加带来的稳定性](由于我们设计的算法是针对多时相下遥感影像的植被提取，所以时相的数量对于算法的性能会造成影响。于是我们实验中修改了时相数量，我们设置了其从3到8，相邻时相间隔两到三个月，探究其F分数和方差的变化。从结果我们可以看出这样的趋势，随着时相数的增加，在植被提取上平均F分数有着明显的提升，从3个时相下的2个百分点到8个时相下的5个百分点，这是因为我们算法中衡量置信度的准则由多个时相的预测结果共同提供，时相数增多能够使该项的结果具有稳定性，从而有利于未变化区域的判断以及训练集更新时未标记样本的选取。时相数量的增加使得算法更加稳定，让多时相训练与它的设计初衷吻合。而这样伴随着时相数量增加带来的进一步提升是一般算法孤立考虑单时相所不具备的特点。)

$$ \frac{(\prod\limits_{i=1}^kP_i)^{\frac{2}{k}}}{\frac{1}{k}\sum\limits_{i=1}^kP_i}\le \frac{(\frac{1}{k}\sum\limits_{i=1}^kP_i)^2}{\frac{1}{k}\sum\limits_{i=1}^kP_i}=\frac{1}{k}\sum\limits_{i=1}^kP_i$$

## 6 Discussions

[Paragraph. 1. 多时相训练能够取得效果的原因，和协同训练的思想相近，考虑数据间一致性和差异性](其实我们算法背后的核心思想仍然是集成学习，但是和一般所述的集成学习思想有所不同。我们不再仅仅是多个分类器针对一组数据给出各自的结果，然后通过集成学习的方法进行提升。而是利用集成学习的思路，为半监督学习中扩增样本提供更高的置信度。尤其是在这个问题设置下，多时相的遥感影像数据赋予了我们的算法天然的多视角学习的条件，数据的相似性让我们算法中各个时相下的模型的结果具有更大的参考价值，而数据分布的差异提供了集成学习中各个分类器的分歧性，而在最终确定更新样本的过程中，算法设置的判别公式融入了调和平均的思想，让所有分类器的联合置信度综合考虑了各个分类器的预测结果，但仅仅是作为一个参考依据，而不是直接下定论给未知数据赋予标签加入训练集中，而是需要等到所有的样本都完成联合置信度的给出之后，再进行更新，考虑了全幅影像的信息，比起一般的集成学习更加稳定，分类结果的空间一致性更高。)

[Paragraph. 2. 多时相训练中对于时相数量上的要求，怎样的时间范围内多时相训练能够在这个框架中取得提升效果]()

## 7 Conclusions

[Paragraph. 1. 该工作的可扩展性和可迁移性很好](比如多时相水体蓝藻检测，时间序列上土地利用信息的更新)

[Paragraph. 2. 未来工作的展望]()



## Acknowledges

感谢国家自然科学基金的支持

## Reference

[1]: B. M. Shahshahani and D. A. Landgrebe, “The effect of unlabeled samples in reducing the small sample size problem and mitigating the Hughes phenomenon,” Int. Geosci. Remote Sens. Symp., vol. 32, no. 5, pp. 1087–1095, 1994.

[2]: T. Joachims, “Transductive Inference for Text Classification using Support Vector Machines,” in ICML ’99 Proceedings of the Sixteenth International Conference on Machine Learning, 1999, pp. 200–209.

[3]: Y. Wu and V. N. Vapnik, “Statistical Learning Theory,” Technometrics, vol. 41, no. 4, p. 377, 1999, doi: 10.2307/1271368.

[4]: M. I. Jordan, Learning in Graphical Models. 1998.

[5]: A. Blum and T. Mitchell, “Combining labeled and unlabeled data with co-training,” in Proceedings of the eleventh annual conference on Computational learning theory, 1998, pp. 92–100.

[6] N. A. Abade, O. Ablio de Carvalho Jnior, R. Fontes Guimares, and S. N. de Oliveira. Comparative analysis of modis time-series classification using support vector machines and methods based upon distance and similarity measures in the brazilian cerrado-caatinga boundary. Remote Sensing, 7(9):12160–12191, 2015.